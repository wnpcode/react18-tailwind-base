import{N as Q}from"./No_Image_Vertikal.d94c0a7e.js";import{i as X,U as Z,p as ee,q as k,k as te,b as v,g as w,a as le,z as ae,e as F,x as se}from"./index.98d46653.js";import{s as re,C as ie,A as oe}from"./styled.58e262dc.js";import{I as N}from"./index.e1191aef.js";import{r as u,u as ne,o as ce,P as pe,j as l,F as ue,c as o,d as r,i as g,_ as a,f as S,a6 as de,a7 as ge,a8 as fe}from"./vendor.9e149c67.js";import{F as E,S as q,C as R}from"./Select.ea97d86c.js";const he=re("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),Te=()=>{const[L,xe]=u.exports.useState(JSON.parse(X("login_data"))||{}),[b,I]=u.exports.useState({file1:"",file2:"",file3:"",file4:"",file5:""}),[m,T]=u.exports.useState({file1:null,file2:null,file3:null,file4:null,file5:null}),{t:i,i18n:me}=ne(),f=u.exports.useContext(Z),D=ce(),C=pe(),[e,O]=u.exports.useState(null),[d,U]=u.exports.useState({name:!0,category:!0,type:!0,title:!0,stock:!0,sku:!0,description:!0,hpp:!0,sellingPrice:!0,tax:!0,price:!0}),[x,V]=u.exports.useState({name:"",category:"",type:"",title:"",stock:"",sku:"",description:"",hpp:"",sellingPrice:"",tax:"",price:""}),[_,z]=u.exports.useState(""),[B,A]=u.exports.useState([...ie]),[H,ye]=u.exports.useState([...oe]),$=async()=>{try{f.setLoading(!0);let t=await F(`${v.product.all[w()]}/${C.id}`);z(t.data.category);let s={file1:null,file2:null,file3:null,file4:null,file5:null};console.log(t.data.images,"image from server"),a.map(t.data.images,(n,h)=>{s[`file${h+1}`]=n}),T(s),I({file1:"",file2:"",file3:"",file4:"",file5:""}),O({...t.data,category:t.data.category.id,type:t.data.productType,hpp:t.data.buyingPrice,price:t.data.sellingPrice+t.data.tax}),f.setLoading(!1)}catch{f.setLoading(!1)}},M=async(t="")=>{try{f.setLoading(!0);let s={};s.name=t;let n=await F(`${v.category.combo[w()]}`,s);A(a.map(n.data,se)),f.setLoading(!1)}catch{f.setLoading(!1)}},p=(t,s)=>{O(n=>({...n,[s]:t}))},W=async()=>{if(!J())return;let t=parseInt(k(a.get(e,"stock"))),s=parseInt(k(a.get(e,"hpp"))),n=parseInt(k(a.get(e,"sellingPrice"))),h=a.get(e,"tax"),c={...e,categoryId:_.id,productType:e.type,companyId:L.companyId,merchantId:L.merchantId,sellingPrice:n,stock:t,buyingPrice:s,tax:h},y=new FormData;const P=JSON.stringify(c),j=new Blob([P],{type:"application/json"});y.append("data",j);try{f.setLoading(!0);let Y=await te(`${v.product.all[w()]}/${C.id}`,y);D("/dashboard/product",{replace:!0})}catch{}finally{f.setLoading(!1)}},J=()=>{let t={name:!0,category:!0,type:!0,stock:!0,sku:!0,description:!0,hpp:!0,sellingPrice:!0,tax:!0,price:!0},s={name:"",category:"",type:"",stock:"",sku:"",description:"",hpp:"",sellingPrice:"",tax:"",price:""},n=["description"],h=a.reject(a.keys(t),c=>n.includes(c));return a.map(h,c=>{a.get(e,c)||(s[c]=`${i(c)} ${i("required")}`,t[c]=!1)}),V(s),U(t),a.reduce(a.values(t),(c,y)=>c&&y,!0)},K=async(t,s)=>{console.log("trigger",t,typeof s,parseInt(s)-1);let n=t.target.files[0];if(n.size>1e6)return toast.error(i("File To Large"));console.log("size approved");try{let h={productId:C.id,index:parseInt(s)-1},c=new FormData;const y=JSON.stringify(h),P=new Blob([y],{type:"application/json"});c.append("data",P),c.append("file",n);let j=await le(`${v.product.image[w()]}`,c);$(),T({...m,[s]:URL.createObjectURL(t.target.files[0])}),I({...b,[s]:t.target.files[0]})}catch(h){console.log(h)}},G=async t=>{let s={productId:C.id,index:parseInt(t)-1};try{f.setLoading(!0);let n=await ae(`${v.product.image[w()]}`,s);T({...m,[`file${t}`]:null}),I({...b,[`file${t}`]:""}),$()}catch(n){console.log(n)}finally{f.setLoading(!1)}};return u.exports.useEffect(()=>{p(ee(e==null?void 0:e.tax,e==null?void 0:e.sellingPrice),"price")},[e==null?void 0:e.sellingPrice,e==null?void 0:e.tax]),u.exports.useEffect(()=>{(async()=>{await M(),$()})()},[]),l(ue,{children:o(r.Card,{className:"mt-12 ",children:[o(r.CardBody,{className:"",children:[l("div",{className:"flex flex-row justify-between",children:o("div",{children:[l(r.Typography,{variant:"h5",children:i("product")})," ",l("span",{children:i("editProduct")})]})}),l(r.Typography,{variant:"h5",className:"mt-4",children:i("generalInformation")}),o("div",{className:" flex w-full flex-row flex-wrap bg-white",children:[o("div",{className:`flex ${g?"w-1/2":"w-full"}  flex-col px-2 py-2`,children:[l("h3",{className:" required text-base font-semibold",children:i("productCategory")}),l(E,{size:"small",error:!d.category&&!a.get(e,"category"),children:l(q,{onChange:t=>{p(t.target.value,"category")},value:e==null?void 0:e.category,children:B.map(t=>l(R,{value:t.value,children:t.label},t.value))},e==null?void 0:e.category)})]}),o("div",{className:`flex ${g?"w-1/2":"w-full"}  flex-col px-2 py-2`,children:[l("h3",{className:" required text-base font-semibold",children:i("productType")}),l(E,{size:"small",error:!d.type&&!a.get(e,"type"),children:l(q,{onChange:t=>{["PRODUCT_WITHOUT_STOCK","SERVICE"].includes(t.target.value)&&p(0,"stock"),p(t.target.value,"type")},value:e==null?void 0:e.type,children:H.map(t=>l(R,{value:t.value,children:t.label},t.value))},e==null?void 0:e.type)})]}),o("div",{className:`flex ${g?"w-1/2":"w-full"}  flex-col px-2 py-2`,children:[l("h3",{className:" required text-base font-semibold",children:i("productName")}),l(r.Input,{color:"blue",type:"text",size:"lg",className:"w-full",onChange:t=>{p(t.target.value,"name")},value:e==null?void 0:e.name,name:"column1",error:!d.name&&!a.get(e,"name")}),l(r.Typography,{className:"text-xs text-red-500",children:!a.get(e,"name")&&x.name})]}),o("div",{className:`flex ${g?"w-1/2":"w-full"}  flex-col px-2 py-2`,children:[l("h3",{className:`${!["PRODUCT_WITHOUT_STOCK","SERVICE"].includes(a.get(e,"type"))&&"required"} text-base font-semibold`,children:i("stock")}),l(N,{disabled:["PRODUCT_WITHOUT_STOCK","SERVICE"].includes(e==null?void 0:e.type),type:"number",invalid:!d.stock&&!a.get(e,"stock"),value:e==null?void 0:e.stock,onValueChange:t=>p(t,"stock"),error:!d.stock&&!a.get(e,"stock")}),l(r.Typography,{className:"text-xs text-red-500",children:!a.get(e,"stock")&&x.stock})]}),o("div",{className:`flex ${g?"w-1/2":"w-full"}  flex-col px-2 py-2`,children:[l("h3",{className:" text-base font-semibold",children:i("sku")}),l(r.Input,{color:"blue",type:"text",size:"lg",className:"w-full",onChange:t=>{p(t.target.value,"sku")},value:e==null?void 0:e.sku,name:"column1",error:!d.sku&&!a.get(e,"sku")}),l(r.Typography,{className:"text-xs text-red-500",children:!a.get(e,"sku")&&x.sku})]}),o("div",{className:`flex ${g?"w-1/2":"w-full"}  flex-col px-2 py-2`,children:[l("h3",{className:" text-base font-semibold",children:i("description")}),l(r.Input,{color:"blue",type:"text",size:"lg",className:"w-full",onChange:t=>{p(t.target.value,"description")},value:e==null?void 0:e.description,name:"column1",error:!d.description&&!a.get(e,"description")}),l(r.Typography,{className:"text-xs text-red-500",children:!a.get(e,"description")&&x.description})]})]}),l(r.Typography,{variant:"h5",children:i("price")}),o("div",{className:"mt-4 flex w-full flex-row flex-wrap bg-white",children:[o("div",{className:`flex ${g?"w-1/2":"w-full"}  flex-col px-2 py-2`,children:[o("h3",{className:" required text-base font-semibold",children:[i("hpp")," "]}),l(N,{invalid:!d.hpp&&(!a.get(e,"hpp")||parseInt(a.get(e,"hpp"))==0),value:e==null?void 0:e.hpp,onValueChange:t=>p(t,"hpp")}),l(r.Typography,{className:"text-xs text-red-500",children:(!a.get(e,"hpp")||parseInt(a.get(e,"hpp"))==0)&&x.hpp})]}),o("div",{className:`flex ${g?"w-1/2":"w-full"}  flex-col px-2 py-2`,children:[l("h3",{className:" required text-base font-semibold",children:i("sellingPrice")}),l(N,{invalid:!d.sellingPrice&&(!a.get(e,"sellingPrice")||parseInt(a.get(e,"sellingPrice"))==0),value:e==null?void 0:e.sellingPrice,onValueChange:t=>{p(t,"sellingPrice")}}),l(r.Typography,{className:"text-xs text-red-500",children:(!a.get(e,"sellingPrice")||parseInt(a.get(e,"sellingPrice"))==0)&&x.sellingPrice})]}),o("div",{className:`flex ${g?"w-1/2":"w-full"}  flex-col px-2 py-2`,children:[l("h3",{className:" required text-base font-semibold",children:i("ppn")}),l(N,{invalid:!d.tax&&(!a.get(e,"tax")||parseInt(a.get(e,"tax"))==0),type:"percentage",value:e==null?void 0:e.tax,onValueChange:t=>{p(t,"tax")}}),l(r.Typography,{className:"text-xs text-red-500",children:(!a.get(e,"tax")||parseInt(a.get(e,"tax"))==0)&&x.tax})]}),o("div",{className:`flex ${g?"w-1/2":"w-full"}  flex-col px-2 py-2`,children:[l("h3",{className:" text-base font-semibold",children:i("priceTotal")}),l(N,{disabled:!0,invalid:!d.price&&(!a.get(e,"price")||parseInt(a.get(e,"price"))==0),value:e==null?void 0:e.price,onValueChange:t=>p(t,"price")}),l(r.Typography,{className:"text-xs text-red-500",children:(!a.get(e,"price")||parseInt(a.get(e,"price"))==0)&&x.price})]}),l("div",{className:`flex ${g?"w-1/2":"w-full"}  flex-col px-2 py-2`,children:l(r.Switch,{color:"purple",checked:e==null?void 0:e.active,onChange:()=>p(!(e!=null&&e.active),"active")})})]}),l(r.Typography,{variant:"h5",children:i("images")}),l("div",{className:"flex flex-row gap-1",children:a.map(a.toArray("12345"),t=>o(r.Card,{className:"group relative flex aspect-square w-1/5 cursor-pointer items-center justify-center overflow-hidden bg-gray-200",onClick:()=>{document.getElementById(`file${t}`).click()},children:[m[`file${t}`]?l("img",{className:"",src:m[`file${t}`],alt:b[`file${t}`].filename}):l("img",{className:" w-96",src:Q,alt:"noImage"}),o("div",{class:"absolute top-0 left-0 flex h-full w-full flex-col items-center justify-center bg-black bg-opacity-0 opacity-0 duration-500 group-hover:h-full group-hover:bg-opacity-80 group-hover:opacity-100",children:[m[`file${t}`]?l(S,{icon:de,className:"fa-3x text-orange-700"}):l(S,{icon:ge,className:"fa-3x text-green-700"}),m[`file${t}`]&&l(S,{onClick:s=>{s.stopPropagation(),G(t)},icon:fe,className:"fa-2x absolute top-2 right-2 text-red-500"})]}),l(he,{id:`file${t}`,type:"file",accept:".jpg,.png,.jpeg",onChange:s=>K(s,t)})]},`image-${t}-`+b[`file${t}`].fileName))})]}),o(r.CardFooter,{className:"flex flex-row-reverse gap-1",children:[l(r.Button,{onClick:()=>{W()},className:" rounded-3xl",size:"sm",color:"purple",variant:"gradient",children:i("save")}),l(r.Button,{onClick:()=>D("/dashboard/product"),className:" rounded-3xl",size:"sm",color:"purple",variant:"outlined",children:i("back")})]})]})})};export{Te as default};
